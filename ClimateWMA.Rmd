---
title: "ClimateWMA"
author: "KateMarkham"
date: "04/26/2022"
output: html_document
---

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(knitr)
library(tidyverse)
library(data.table)
library(readr)
library(ggplot2)
library(gridExtra)
library(car)
library(stargazer)
library(tmap)
library(lmtest)
library(sf)
library(Hmisc)
```


Import all of the communal lands data and make Year and Month factors rather than numeric.
```{r echo=TRUE, message=FALSE, warning=FALSE}
#Import data
WMA_LST <- read_csv("WMA_LST.csv")
WMA_LST$Year<-factor(WMA_LST$Year)
WMA_LST$Month<-factor(WMA_LST$Month)
LST<-WMA_LST

WMA_NDVI <- read_csv("WMA_NDVI.csv")
WMA_NDVI$Year<-factor(WMA_NDVI$Year)
WMA_NDVI$Month<-factor(WMA_NDVI$Month)
NDVI<-WMA_NDVI 

WMA_Precip <- read_csv("WMA_Precip.csv")
WMA_Precip$Year<-factor(WMA_Precip$Year)
WMA_Precip$Month<-factor(WMA_Precip$Month)
Precip<-WMA_Precip
  
WMA_Soil <- read_delim("WMA_Soil.csv", delim = "\t", 
    escape_double = FALSE, trim_ws = TRUE)
WMA_Soil$Year<-factor(WMA_Soil$Year)
WMA_Soil$Month<-factor(WMA_Soil$Month)
Soil<-WMA_Soil
```


Plot LST
```{r}

ggplot(LST,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median LST in communal lands")+ 
  xlab("Month") + ylab("LST (K)") +
  facet_wrap(~Year)
```


Plot precip by year in all communal lands
```{r}

ggplot(Precip,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median precipitation in communal lands")+ 
  xlab("Month") + ylab("Precipitation (mm/month)") +
  facet_wrap(~Year)
```

Soil moisture 10 to 40 cm by year in all communal lands
```{r}

ggplot(Soil,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median soil moisture (10 to 40 cm depth) in communal lands")+ 
  xlab("Month") + ylab("Soil moisture (m3/m3)") +
  facet_wrap(~Year)

```

NDVI by year in all communal lands
```{r}

ggplot(NDVI,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median NDVI in communal lands")+ 
  xlab("Month") + ylab("Median NDVI (1-200)") +
  facet_wrap(~Year)

```

Crop raiding months only
LST
```{r echo=TRUE, message=FALSE, warning=FALSE}

LST_CR<-LST%>% 
  filter(Month%in% c("03", "04", "05"))

CR_LST_Plot<-ggplot(LST_CR,aes(x=Month,y=MEDIAN, color=NAME))+
  geom_point() + ggtitle("Median LST in communal lands during crop raiding season")+ 
  xlab("Month") + ylab("LST (K)") +
  facet_wrap(~Year)
CR_LST_Plot1<-CR_LST_Plot + scale_color_discrete(name="Communal land")
CR_LST_Plot
```

Precipitation
```{r echo=TRUE, message=FALSE, warning=FALSE}

Precip_CR<-Precip %>% 
  filter(Month%in% c("03", "04", "05"))

CR_Precip<-ggplot(Precip_CR,aes(x=Month,y=MEDIAN, color=NAME))+
  geom_point() + ggtitle("Median precipitation in communal lands during crop raiding season")+ 
  xlab("Month") + ylab("Precipitation (mm/month)") +
  facet_wrap(~Year)
CR_Precip1<-CR_Precip + scale_color_discrete(name="Communal land")
CR_Precip1
```


```{r echo=TRUE, message=FALSE, warning=FALSE}
#Soil Moisture Plots for crop raiding period 
#Maximum NDVI
Soil_CR<-Soil %>% 
  filter(Month %in% c(3, 4, 5))
p1<-ggplot(Soil_CR,aes(x=Month,y=MEDIAN,color=NAME))+
  geom_point()+
  xlab("Month") + ylab("Median Soil Moisture (m3/m3)") +ggtitle("Median soil mosture in communal lands during crop raiding season") +
  facet_wrap(~Year)
p1<-p1 + scale_color_discrete(name="Communal land")
p1

```




NDVI
```{r echo=TRUE, message=FALSE, warning=FALSE}
#NDVI Plots for crop raiding period 
#Maximum NDVI
NDVI_CR<-NDVI %>% 
  filter(Month%in% c("03", "04", "05"))
p1<-ggplot(NDVI_CR,aes(x=Month,y=MEDIAN,color=NAME))+
  geom_point()+
  xlab("Month") + ylab("Median NDVI (0-200)") +ggtitle("Median NDVI in communal lands during crop raiding season") +
  facet_wrap(~Year)
p1<-p1 + scale_color_discrete(name="Communal land")
p1
```
Test for normality
Shapiro test: if p<0.01, data is not normally distributed.
```{r}
shapiro.test(NDVI$MEDIAN) 
qqnorm(NDVI$MEDIAN); qqline(NDVI$MEDIAN)
```


Land Cover Analysis
Data import
```{r echo=TRUE, message=FALSE, warning=FALSE}
LC_LST <- read_csv("LC_LST.csv")
LC_LST$Year<-factor(LC_LST$Year)
LC_LST$Month<-factor(LC_LST$Month)
LC_Precip <- read_csv("LC_Precip.csv")
LC_Precip$Year<-factor(LC_Precip$Year)
LC_Precip$Month<-factor(LC_Precip$Month)
LC_Soil<-LC_Soil <- read_csv("LC_Soil.csv")
LC_Soil$Year<-factor(LC_Soil$Year)
LC_Soil$Month<-factor(LC_Soil$Month)
LC_NDVI <- read_csv("LC_NDVI.csv")
LC_NDVI$Year<-factor(LC_NDVI$Year)
LC_NDVI$Month<-factor(LC_NDVI$Month)
```


LST all land cover types
```{r echo=TRUE, message=FALSE, warning=FALSE}
ggplot(LC_LST,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median LST in different land cover types")+ 
  xlab("Month") + ylab("LST (K)") +
  facet_wrap(~Year)

LST_LC_Plot<-ggplot(LC_LST,aes(x=Month,y=MEDIAN, color=LC))+
  geom_point() + ggtitle("Median LST by Land Cover")+ 
  xlab("Month") + ylab("LST (K)") +
  facet_wrap(~Year)
LST_LC_Plot1<-LST_LC_Plot + scale_color_discrete(name="LC")
LST_LC_Plot1
```

Precip all land cover types
```{r echo=TRUE, message=FALSE, warning=FALSE}
ggplot(LC_Precip,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median Precip in different land cover types")+ 
  xlab("Month") + ylab("Precip") +
  facet_wrap(~Year)

Precip_LC_Plot<-ggplot(LC_Precip,aes(x=Month,y=MEDIAN, color=LC))+
  geom_point() + ggtitle("Median Precipitation by Land Cover")+ 
  xlab("Month") + ylab("Precip") +
  facet_wrap(~Year)
Precip_LC_Plot1<-Precip_LC_Plot + scale_color_discrete(name="LC")
Precip_LC_Plot1
```
NDVI for all land cover types

NDVI all land cover types
```{r echo=TRUE, message=FALSE, warning=FALSE}
ggplot(LC_NDVI,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median NDVI in different land cover types")+ 
  xlab("Month") + ylab("NDVI") +
  facet_wrap(~Year)

LC_NDVI_Plot<-ggplot(LC_NDVI,aes(x=Month,y=MEDIAN, color=LC))+
  geom_point() + ggtitle("Median NDVI by Land Cover")+ 
  xlab("Month") + ylab("NDVI (0-200)") +
  facet_wrap(~Year)
LC_NDVI_Plot1<-LC_NDVI_Plot + scale_color_discrete(name="LC")
LC_NDVI_Plot1
```


Median NDVI CR by LC
```{r echo=TRUE, message=FALSE, warning=FALSE}
#NDVI Plots for crop raiding period 
#Maximum NDVI
LCNDVI_CR<-LC_NDVI %>% 
  filter(Month%in% c("03", "04", "05"))
p1<-ggplot(LCNDVI_CR,aes(x=Month,y=MEDIAN,color=LC))+
  geom_point()+
  xlab("Month") + ylab("Median NDVI (0-200)") +ggtitle("Median NDVI during crop raiding season by land cover") +
  facet_wrap(~Year)
p1<-p1 + scale_color_discrete(name="Land cover type")
p1
```
NDVI
```{r echo=TRUE, message=FALSE, warning=FALSE}
#NDVI Plots for crop raiding period 
#Maximum NDVI
LCNDVI_CR<-LC_NDVI %>% 
  filter(Month%in% c("03", "04", "05"))
p1<-ggplot(LCNDVI_CR,aes(x=Month,y=PCT90,color=LC))+
  geom_point()+
  xlab("Month") + ylab("90th Percentile NDVI (0-200)") +ggtitle("90th Percentile NDVI during crop raiding season by land cover") +
  facet_wrap(~Year)
p1<-p1 + scale_color_discrete(name="Land cover type")
p1
```

```{r}
ggplot(LC_Soil,aes(x=Month,y=MEDIAN))+
  geom_boxplot() + ggtitle("Median Soil Moisture in different land cover types")+ 
  xlab("Month") + ylab("Soil Moisture") +
  facet_wrap(~Year)

LC_Soil_Plot<-ggplot(LC_Soil,aes(x=Month,y=MEDIAN, color=LC))+
  geom_point() + ggtitle("Median Soil Moisture by Land Cover")+ 
  xlab("Month") + ylab("Soil Moisture") +
  facet_wrap(~Year)
LC_Soil_Plot1<-LC_Soil_Plot + scale_color_discrete(name="LC")
LC_Soil_Plot1
```


Test for normality
Shapiro test: if p<0.01, data is not normally distributed.
```{r}
shapiro.test(LC_NDVI$MEDIAN) 
qqnorm(LC_NDVI$MEDIAN); qqline(LC_NDVI$MEDIAN)

shapiro.test(LC_Precip$MEDIAN) 
qqnorm(LC_Precip$MEDIAN); qqline(LC_Precip$MEDIAN)

shapiro.test(LC_Soil$MEDIAN) 
qqnorm(LC_Soil$MEDIAN); qqline(LC_Soil$MEDIAN)

shapiro.test(LC_LST$MEDIAN) 
qqnorm(LC_LST$MEDIAN); qqline(LC_LST$MEDIAN)
```
Data is not normally distributed.

Test for normality
Shapiro test: if p<0.01, data is not normally distributed.
```{r}
shapiro.test(LC_NDVI$PCT90) 
qqnorm(LC_NDVI$MIN); qqline(LC_NDVI$PCT90)

shapiro.test(LC_Precip$PCT90) 
qqnorm(LC_Precip$PCT90); qqline(LC_Precip$PCT90)

shapiro.test(LC_Soil$PCT90) 
qqnorm(LC_Soil$PCT90); qqline(LC_Soil$PCT90)

shapiro.test(LC_LST$PCT90) 
qqnorm(LC_LST$PCT90); qqline(LC_LST$PCT90)
```
Test for normality
Shapiro test: if p<0.01, data is not normally distributed.
```{r}
shapiro.test(LC_NDVI$PCT90) 
qqnorm(LC_NDVI$PCT90); qqline(LC_NDVI$PCT90)

shapiro.test(LC_Precip$PCT90) 
qqnorm(LC_Precip$PCT90); qqline(LC_Precip$PCT90)

shapiro.test(LC_Soil$PCT90) 
qqnorm(LC_Soil$PCT90); qqline(LC_Soil$PCT90)

shapiro.test(LC_LST$PCT90) 
qqnorm(LC_LST$PCT90); qqline(LC_LST$PCT90)
```

```{r}
cor(LC_Soil$MEDIAN, LC_Soil$AREA)
cor(LC_NDVI$MEDIAN,LC_NDVI$AREA)
cor(LC_Precip$MEDIAN,LC_Precip$AREA)

LCdf<-(LC_Precip$MEDIAN, LC_Precip$PCT90, LC_Precip$Year, LC_Precip$Month)

```

